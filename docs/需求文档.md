# 随手记账 - 产品需求文档

## 项目概述

随手记账是一款简单易用的个人财务管理工具，用户可以记录日常开支和收入，管理账单分类，并查看账单列表与统计数据。该应用目前为纯前端实现，未来将扩展为支持后端服务的完整应用。

## 功能与页面规格

### 1. 首页（Home）

#### 功能描述

- 展示账单摘要统计信息（总收入、总支出、结余）
- 显示最近账单记录列表
- 提供数据刷新功能

#### 前端功能需求

- **数据处理**：
  - 读取：获取统计摘要数据和最近账单列表
  - 刷新：重新获取统计摘要和最近账单数据

#### 数据需求

- 统计摘要数据：
  - `expense`：总支出金额
  - `income`：总收入金额
  - `balance`：结余金额（收入 - 支出）
- 最近账单数据（与账单列表相同，但只显示最近 5-10 条）

#### 后端 API 需求

1. **获取统计摘要数据**

   - 接口：`GET /api/bills/summary`
   - 响应参数：
     ```json
     {
       "success": true,
       "data": {
         "expense": 1500.0,
         "income": 3000.0,
         "balance": 1500.0
       }
     }
     ```

2. **获取近期账单**
   - 接口：`GET /api/bills/recent`
   - 请求参数：`?limit=5`（限制返回的账单数量）
   - 响应参数：
     ```json
     {
       "success": true,
       "data": [
         {
           "_id": "123456",
           "amount": 100.0,
           "type": "expense",
           "categoryId": "c123",
           "category": {
             "_id": "c123",
             "name": "餐饮",
             "type": "expense"
           },
           "date": "2025-10-20T00:00:00.000Z",
           "note": "午餐",
           "createdAt": "2025-10-20T12:00:00.000Z"
         }
         // ... 更多账单数据
       ]
     }
     ```

### 2. 账单列表（BillList）

#### 功能描述

- 展示所有账单的列表，包括账单金额、类型、分类、日期和备注
- 支持分页浏览账单
- 提供筛选功能（日期范围、账单类型、分类、关键词）
- 显示筛选结果的统计摘要（收入总额、支出总额）
- 提供编辑和删除操作
- 提供新增账单入口

#### 前端功能需求

- **账单表格**：
  - 表格列：日期、类型、金额、分类、备注、操作
  - 金额根据收入/支出类型显示不同颜色
  - 分页控件：支持页码跳转和每页显示条数调整
  - 操作列：编辑按钮和删除按钮
- **数据处理**：
  - 读取：获取账单列表数据，支持分页和筛选
  - 删除：删除选定的账单记录
  - 跳转：点击编辑按钮跳转到编辑账单页面
  - 新增：点击新增按钮跳转到新增账单页面

#### 数据需求

- 账单数据：
  - 字段：`_id`、`amount`、`type`、`categoryId`、`category`、`date`、`note`、`createdAt`
  - 分页信息：`current`（当前页码）、`pageSize`（每页条数）、`total`（总条数）
- 分类数据（用于筛选）：
  - 字段：`_id`、`name`、`type`

#### 后端 API 需求

1. **获取账单列表**

   - 接口：`GET /api/bills`
   - 请求参数：
     - `page`：页码（默认 1）
     - `limit`：每页条数（默认 10）
     - `type`：账单类型（可选，"expense"或"income"）
     - `categoryId`：分类 ID（可选）
     - `startDate`：开始日期（可选，格式：YYYY-MM-DD）
     - `endDate`：结束日期（可选，格式：YYYY-MM-DD）
     - `keyword`：关键词（可选，搜索备注字段）
   - 响应参数：
     ```json
     {
       "success": true,
       "data": {
         "list": [
           {
             "_id": "123456",
             "amount": 100.0,
             "type": "expense",
             "categoryId": "c123",
             "category": {
               "_id": "c123",
               "name": "餐饮",
               "type": "expense"
             },
             "date": "2025-10-20T00:00:00.000Z",
             "note": "午餐",
             "createdAt": "2025-10-20T12:00:00.000Z"
           }
           // ... 更多账单数据
         ],
         "pagination": {
           "current": 1,
           "pageSize": 10,
           "total": 50
         },
         "stats": {
           "totalIncome": 3000.0,
           "totalExpense": 1500.0
         }
       }
     }
     ```

2. **删除账单**
   - 接口：`DELETE /api/bills/:id`
   - 路径参数：`id`（账单 ID）
   - 响应参数：
     ```json
     {
       "success": true,
       "message": "账单删除成功"
     }
     ```

### 3. 新增/编辑账单（BillForm）

#### 功能描述

- 提供表单，用户可以填写账单信息（金额、类型、分类、日期、备注）
- 支持切换账单类型（收入/支出）
- 根据账单类型显示对应的分类选项
- 支持新增分类的快捷操作
- 编辑模式下自动填充当前账单数据

#### 前端功能需求

- **表单组件**：
  - 账单类型：单选按钮组（收入/支出）
  - 分类选择：下拉选择框，根据当前账单类型动态显示对应分类
  - 分类管理：新增分类按钮，点击后显示分类名称输入框
  - 日期范围选择：日期选择器，默认选择近七天日期，不能选未来
  - 备注输入：多行文本框，可选填
- **数据处理**：
  - 读取：
    - 获取分类列表数据
    - 编辑模式下获取指定账单的详细信息
  - 创建：
    - 创建新账单记录
    - 创建新分类记录（快捷创建）
  - 更新：编辑模式下更新现有账单记录

#### 数据需求

- 分类数据：
  - 字段：`_id`、`name`、`type`
- 账单详情数据（编辑模式）：
  - 字段：`_id`、`amount`、`type`、`categoryId`、`date`、`note`

#### 后端 API 需求

1. **获取分类列表**

   - 接口：`GET /api/categories`
   - 响应参数：
     ```json
     {
       "success": true,
       "data": [
         {
           "_id": "c123",
           "name": "餐饮",
           "type": "expense"
         },
         {
           "_id": "c124",
           "name": "工资",
           "type": "income"
         }
         // ... 更多分类数据
       ]
     }
     ```

2. **获取账单详情**

   - 接口：`GET /api/bills/:id`
   - 路径参数：`id`（账单 ID）
   - 响应参数：
     ```json
     {
       "success": true,
       "data": {
         "_id": "123456",
         "amount": 100.0,
         "type": "expense",
         "categoryId": "c123",
         "date": "2025-10-20T00:00:00.000Z",
         "note": "午餐",
         "createdAt": "2025-10-20T12:00:00.000Z"
       }
     }
     ```

3. **新增账单**

   - 接口：`POST /api/bills`
   - 请求参数：
     ```json
     {
       "amount": 100.0,
       "type": "expense",
       "categoryId": "c123",
       "date": "2025-10-20T00:00:00.000Z",
       "note": "午餐"
     }
     ```
   - 响应参数：
     ```json
     {
       "success": true,
       "message": "账单创建成功",
       "data": {
         "_id": "123456"
         // ... 返回创建的账单数据
       }
     }
     ```

4. **更新账单**

   - 接口：`PUT /api/bills/:id`
   - 路径参数：`id`（账单 ID）
   - 请求参数：
     ```json
     {
       "amount": 150.0,
       "type": "expense",
       "categoryId": "c123",
       "date": "2025-10-20T00:00:00.000Z",
       "note": "午餐和晚餐"
     }
     ```
   - 响应参数：
     ```json
     {
       "success": true,
       "message": "账单更新成功",
       "data": {
         "_id": "123456"
         // ... 返回更新后的账单数据
       }
     }
     ```

5. **新增分类**
   - 接口：`POST /api/categories`
   - 请求参数：
     ```json
     {
       "name": "交通",
       "type": "expense"
     }
     ```
   - 响应参数：
     ```json
     {
       "success": true,
       "message": "分类创建成功",
       "data": {
         "_id": "c125",
         "name": "交通",
         "type": "expense",
         "createdAt": "2025-10-23T10:30:00.000Z"
       }
     }
     ```

### 4. 分类管理（Categories）

#### 功能描述

- 展示按类型（收入/支出）分组的分类列表
- 提供新增、编辑和删除分类的功能
- 支持在不同类型（收入/支出）间切换

#### 前端功能需求

- **数据处理**：
  - 读取：获取所有分类列表数据
  - 创建：通过弹窗创建新分类
  - 更新：通过弹窗编辑现有分类
  - 删除：删除指定分类（需二次确认）

#### 数据需求

- 分类数据：
  - 字段：`_id`、`name`、`type`、`createdAt`

#### 后端 API 需求

1. **获取分类列表**（同新增账单页面）

2. **新增分类**（同新增账单页面）

3. **更新分类**

   - 接口：`PUT /api/categories/:id`
   - 路径参数：`id`（分类 ID）
   - 请求参数：
     ```json
     {
       "name": "交通出行",
       "type": "expense"
     }
     ```
   - 响应参数：
     ```json
     {
       "success": true,
       "message": "分类更新成功",
       "data": {
         "_id": "c125",
         "name": "交通出行",
         "type": "expense",
         "updatedAt": "2025-10-23T11:30:00.000Z"
       }
     }
     ```

4. **删除分类**
   - 接口：`DELETE /api/categories/:id`
   - 路径参数：`id`（分类 ID）
   - 响应参数：
     ```json
     {
       "success": true,
       "message": "分类删除成功"
     }
     ```

## 数据模型

### 1. 账单（Bill）

```typescript
interface Bill {
  _id?: string; // 账单ID
  amount: number; // 金额
  type: 'expense' | 'income'; // 类型（支出/收入）
  categoryId: string; // 分类ID
  category?: Category; // 分类信息（关联查询时）
  date: Date | string; // 日期
  note?: string; // 备注
  createdAt?: Date; // 创建时间
  updatedAt?: Date; // 更新时间
}
```

### 2. 分类（Category）

```typescript
interface Category {
  _id?: string; // 分类ID
  name: string; // 分类名称
  type: 'expense' | 'income'; // 类型（支出/收入）
  icon?: string; // 图标（可选）
  createdAt?: Date; // 创建时间
  updatedAt?: Date; // 更新时间
}
```

### 3. 分页（Pagination）

```typescript
interface Pagination {
  current: number; // 当前页码
  pageSize: number; // 每页数量
  total: number; // 总数据条数
}
```

### 4. 查询参数（QueryParams）

```typescript
interface QueryParams {
  page?: number; // 页码
  limit?: number; // 每页数量
  type?: 'expense' | 'income'; // 类型筛选
  categoryId?: string; // 分类筛选
  startDate?: Date | string; // 开始日期
  endDate?: Date | string; // 结束日期
  keyword?: string; // 关键词搜索
}
```

## 数据操作汇总

### 账单（Bills）操作

| 页面     | 操作类型 | 描述                           |
| -------- | -------- | ------------------------------ |
| 首页     | 读取     | 获取统计摘要数据和最近账单列表 |
| 账单列表 | 读取     | 获取账单列表（支持分页和筛选） |
| 账单列表 | 删除     | 删除指定账单                   |
| 新增账单 | 创建     | 创建新账单记录                 |
| 编辑账单 | 读取     | 获取指定账单详情               |
| 编辑账单 | 更新     | 更新账单信息                   |

### 分类（Categories）操作

| 页面     | 操作类型 | 描述             |
| -------- | -------- | ---------------- |
| 新增账单 | 读取     | 获取分类列表     |
| 新增账单 | 创建     | 快捷创建新分类   |
| 编辑账单 | 读取     | 获取分类列表     |
| 编辑账单 | 创建     | 快捷创建新分类   |
| 分类管理 | 读取     | 获取所有分类列表 |
| 分类管理 | 创建     | 创建新分类       |
| 分类管理 | 更新     | 编辑现有分类     |
| 分类管理 | 删除     | 删除指定分类     |

## 技术特性与注意事项

### 前端技术栈

- React + TypeScript
- UmiJS 框架
- Ant Design UI 组件库
- Day.js 处理日期

### 后端接口规范

1. 统一响应格式

   ```typescript
   interface ApiResponse<T> {
     success: boolean; // 请求是否成功
     data?: T; // 响应数据
     message?: string; // 错误或成功提示信息
     error?: string; // 错误信息（出错时）
   }
   ```

2. 错误处理
   - HTTP 状态码：使用合适的状态码表示不同类型的错误
   - 详细错误信息：在响应中提供明确的错误信息

### 未来扩展计划

1. **用户认证功能**

   - 用户注册/登录/找回密码
   - 按用户隔离数据

2. **统计分析功能**

   - 按月/年查看收支趋势图
   - 分类占比饼图
   - 消费习惯分析

3. **数据导入/导出**

   - 支持 Excel/CSV 导入导出
   - 数据备份与恢复

4. **预算管理**

   - 设置月度/年度预算
   - 超支预警提醒

5. **多平台支持**
   - 移动端适配
   - 桌面客户端开发
